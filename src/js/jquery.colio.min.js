(function($,undefined){"use strict";function Colio(list,settings){this.list=$(list);this.items=this.list.children();this.settings=settings;this.position=0;this.active_id=undefined;this.lock=false;var self=this;this.items.addClass('colio-item');this.markup=$('<div class="colio"></div>');this.markup.append('<div class="colio-container"></div>');if(this.settings.navigation){this.markup.addClass('colio-has-navigation');$('<div class="colio-navigation"></div>').append('<a class="colio-prev" href="#">'+this.settings.prevText+'</a>').append('<a class="colio-next" href="#">'+this.settings.nextText+'</a>').appendTo(this.markup);}
this.markup.append('<a class="colio-close" href="#">'+this.settings.closeText+'</a>');if(this.settings.placement==='after'){this.list.after(this.markup);}else if(this.settings.placement==='inside'){this.markup.css({position:'absolute',top:0,left:0});$('body').append(this.markup);}else if(/^#\w/.test(this.settings.placement)){$(this.settings.placement).append(this.markup);this.settings.placement='element';}else{this.list.before(this.markup);this.settings.placement='before';}
if(this.settings.id){this.markup.attr('id',this.settings.id);}
this.markup.addClass('colio-placement-'+this.settings.placement);if(this.settings.theme){this.markup.addClass('colio-theme-'+this.settings.theme);}
this.items.find(this.settings.expandLink).click(function(){self.page_scroll=$('.st-content').get(0).offsetTop;var item=$(this).closest('.colio-item');self.expand(item);return false;});this.markup.find('.colio-close').click(function(){self.collapse();return false;});this.markup.find('.colio-prev').click(function(){if(!self.lock&&self.position>0){self.position--;self.expand(self.items.eq(self.position));}
return false;}).end().find('.colio-next').click(function(){if(!self.lock&&self.position<self.items.length-1){self.position++;self.expand(self.items.eq(self.position));}
return false;});$(window).resize(function(e){if(self.settings.placement==='inside'){self.insideHideViewport();}
if(!self.temp){self.temp=[self.settings.syncScroll,self.settings.scrollPage];}
self.settings.syncScroll=true;self.settings.scrollPage=false;clearTimeout(self.resize_timer);self.resize_timer=setTimeout(function(){self.expandViewport(self.active_id,true);self.settings.syncScroll=self.temp[0];self.settings.scrollPage=self.temp[1];delete self.temp;},200);if(e.target===self.markup.get(0)){e.stopImmediatePropagation();}});this.api={expand:function(n){self.expand(self.items.eq(n));},collapse:function(){self.collapse();},excludeHidden:function(){self.items=self.list.children(':not('+self.settings.hiddenItems+')');self.position=self.items.index(self.list.find('.colio-active-item'));if(self.settings.placement==='inside'){self.insideHideViewport();}}};this.list.data('colio',this.api);this.list.bind('colio',function(e,method,param){if(self.api.hasOwnProperty(method)){self.api[method](param);}});}
Colio.prototype.expand=function(item){var content_data=item.data('content');if(this.lock||!content_data){return;}
this.lock=true;this.position=this.items.index(item);if(this.settings.placement==='inside'){this.insidePositionViewport(item);}
var content_id=item.data('colio-content-id');if(content_id){if(this.settings.placement==='inside'){this.insideMakeGap(item);}
this.expandViewport(content_id);}else{this.loadContent(content_data,function(content_id){item.data('colio-content-id',content_id);if(this.settings.placement==='inside'){this.insideMakeGap(item);}
this.expandViewport(content_id);});}
this.markup.find('.colio-navigation a').removeClass('colio-no-prev colio-no-next');if(this.position===0){this.markup.find('.colio-prev').addClass('colio-no-prev');}
if(this.position===this.items.length-1){this.markup.find('.colio-next').addClass('colio-no-next');}
this.items.removeClass('colio-active-item');item.addClass('colio-active-item');};Colio.prototype.loadContent=function(data,callback){var self=this;var _addContentDiv=function(content){content=$(content);if(self.settings.contentFilter){content=content.filter(self.settings.contentFilter);if(content.length===0){content=content.end().find(self.settings.contentFilter);}}
var content_id='colio_'+Math.floor(Math.random()*100000);$('<div id="'+content_id+'" class="colio-content"></div>').append(content).appendTo(self.markup.find('.colio-container'));if(typeof self.settings.onContent==='function'){self.settings.onContent.call(self.markup.get(0),self.markup.find('#'+content_id).get(0));}
return content_id;};if(/^#\w/.test(data)){var html=$(data).html();var content_id=_addContentDiv(html);setTimeout(function(){callback.call(self,content_id);},20);}else if(/(^\.{0,2}\/+\w)|(^https?:\/\/\w)/.test(data)){$.get(data,function(html){callback.call(self,_addContentDiv(html));});}else{var content_id=_addContentDiv(data);setTimeout(function(){callback.call(self,content_id);},20);}};Colio.prototype.expandViewport=function(content_id,adjust){var duration=this.settings.expandDuration,easing=this.settings.expandEasing,sync=this.settings.syncScroll,viewport_top=this.markup.get(0).offsetTop-parseInt(this.settings.scrollOffset,10),viewport_height=this.getViewportHeight(content_id);if(viewport_height===0||(!adjust&&content_id===this.active_id)){this.lock=false;return;}
this.switchContent(content_id);this.markup.stop().animate({height:viewport_height},duration,easing,$.proxy(function(){this.markup.addClass('colio-expanded');this.scroll(viewport_top,!sync);this.lock=false;if(typeof this.settings.onExpand==='function'){this.settings.onExpand.call(this.markup.get(0),content_id);}},this));console.log(viewport_top);this.scroll(viewport_top,sync);};Colio.prototype.switchContent=function(content_id){var active_content=this.markup.find('#'+this.active_id),new_content=this.markup.find('#'+content_id);if(this.active_id===content_id){return;}
if(active_content.length){active_content.stop().fadeOut(this.settings.contentFadeOut,$.proxy(function(){new_content.fadeIn(this.settings.contentFadeIn);},this));}else{new_content.delay(this.settings.contentDelay).fadeIn(this.settings.contentFadeIn);}
this.active_id=content_id;};Colio.prototype.getViewportHeight=function(content_id){var container=this.markup.find('.colio-container'),container_width=container.width(),container_padding=container.outerHeight()-container.height(),content=this.markup.find('#'+content_id),content_height=0;if(content.is(':visible')){content_height=content.height();}else{content.css({display:'block',position:'absolute',visibility:'hidden',width:container_width});content_height=content.height();content.css({display:'',position:'',visibility:'',width:''});}
return content_height>0?content_height+container_padding:0;};Colio.prototype.scroll=function(top,allow){var duration=this.settings.scrollDuration,easing=this.settings.scrollEasing;if(!this.settings.scrollPage){return;}
if(allow){$('.st-content').stop().animate({scrollTop:top},duration,easing);}};Colio.prototype.collapse=function(){var duration=this.settings.collapseDuration,easing=this.settings.collapseEasing,sync=this.settings.syncScroll;this.position=undefined;this.markup.stop().animate({height:0},duration,easing,$.proxy(function(){this.markup.find('.colio-content:visible').hide();this.items.removeClass('colio-active-item');this.scroll(this.page_scroll,!sync);if(typeof this.settings.onCollapse==='function'){this.settings.onCollapse.call(this.markup.get(0),this.active_id);}
this.active_id=undefined;},this));this.markup.removeClass('colio-expanded');if(this.settings.placement==='inside'){this.insideJoinGap();}
this.scroll(this.page_scroll,sync);};Colio.prototype.insideBottomItems=function(item){var in_row=Math.floor(this.list.width()/item.outerWidth(true));in_row=Math.max(1,in_row);var total_rows=Math.ceil(this.items.length/in_row),row=Math.floor(this.items.index(item)/in_row);if(row<total_rows-1){row=row+1;}
return this.items.slice(row*in_row);};Colio.prototype.insideMakeGap=function(item){var duration=this.settings.expandDuration,easing=this.settings.expandEasing;var content_id=item.data('colio-content-id');var viewport_height=this.getViewportHeight(content_id);viewport_height+=parseFloat(this.markup.css('margin-bottom'));$.each(this.insideBottomItems(item),function(){var item_top=$(this).data('colio-item-top');if(item_top===undefined){item_top=parseFloat($(this).css('top'))||0;$(this).data('colio-item-top',item_top);}
$(this).addClass('colio-bottom-item');$(this).stop().animate({top:item_top+viewport_height},duration,easing);});var list_height=this.list.data('colio-list-height');if(list_height===undefined){list_height=this.list.height();this.list.data('colio-list-height',list_height);}
this.list.height(list_height+viewport_height);};Colio.prototype.insideJoinGap=function(no_animation){var duration=this.settings.collapseDuration,easing=this.settings.collapseEasing;this.items.filter('.colio-bottom-item').each(function(){var item_top=$(this).data('colio-item-top')||0;if(no_animation){$(this).css('top',item_top);}else{$(this).stop().animate({top:item_top},duration,easing);}
$(this).removeData('colio-item-top').removeClass('colio-bottom-item');});var list_height=this.list.data('colio-list-height');this.list.addClass('no-transition').height(list_height);this.list.get(0).offsetHeight;this.list.removeClass('no-transition').removeData('colio-list-height');};Colio.prototype.insidePositionViewport=function(item){var bottom_items=this.insideBottomItems(item);if(this.active_id){var active_bottom_items=this.items.filter('.colio-bottom-item');if(active_bottom_items.length!==bottom_items.length){this.insideHideViewport();this.insidePositionViewport(item);}}else{if(/absolute|relative/.test(this.items.eq(0).css('position'))===false){this.items.css({position:'relative',top:0,left:0});}
var vp_margin_left=parseFloat(this.markup.css('margin-left')),vp_margin_right=parseFloat(this.markup.css('margin-right')),vp_left=this.list.offset().left+vp_margin_left,vp_width=this.list.width()-(vp_margin_left+vp_margin_right),vp_top=bottom_items.offset().top;this.markup.css({top:vp_top,left:vp_left,width:vp_width});}};Colio.prototype.insideHideViewport=function(){if(this.active_id===undefined){return;}
this.active_id=undefined;this.insideJoinGap(true);this.markup.height(0).find('.colio-content:visible').hide();this.items.removeClass('colio-active-item');this.markup.removeClass('colio-expanded');};$.fn.colio=function(c){var s=$.extend({id:'colio',theme:'',placement:'before',expandLink:'.colio-link',expandDuration:500,expandEasing:'swing',collapseDuration:300,collapseEasing:'swing',scrollPage:true,syncScroll:false,scrollDuration:300,scrollEasing:'swing',scrollOffset:10,contentFadeIn:500,contentFadeOut:200,contentDelay:200,navigation:true,closeText:'<span>Close</span>',nextText:'<span>Next</span>',prevText:'<span>Prev</span>',contentFilter:'',hiddenItems:'.hidden',onExpand:function(){},onCollapse:function(){},onContent:function(){}},c);return this.each(function(){var colio=new Colio(this,s);});};})(jQuery);